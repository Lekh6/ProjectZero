{% extends 'layout.html' %}

{% block title %}
    Login
{% endblock %}

{% block main %}

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Premium Task App — Frontend Demo</title>
  <style>
    /* Minimal reset */
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,Segoe UI,Arial,Helvetica,sans-serif;background:#0b0d0f;color:#e6eef6}
    :root{
      --bg1:#071018; --bg2:#052f2a; --accent:#06d6a0; --muted: #9aa6b2; --card:#0f1720;
      --glass: rgba(255,255,255,0.04);
    }

    /* page background with diagonal band */
    .page{
      min-height:100vh;display:grid;grid-template-rows:auto 1fr;position:relative;overflow:hidden;
      background: linear-gradient(135deg,var(--bg1) 0%, #0d1620 45%, #06393b 100%);
    }
    .diagonal-band{position:absolute;left:50%;top:-10%;width:220%;height:28vh;transform:translateX(-50%) rotate(-18deg);background:linear-gradient(90deg, rgba(6,214,160,0.14), rgba(255,255,255,0.06), rgba(0,120,105,0.12));filter:blur(50px) saturate(120%);mix-blend-mode:screen;pointer-events:none}

    /* top bar */
    header{height:64px;display:flex;align-items:center;justify-content:center;z-index:4;position:relative}
    .brand{font-weight:700;letter-spacing:0.6px;background:linear-gradient(90deg,#bfffe6,#7ef1d0);-webkit-background-clip:text;background-clip:text;color:transparent}

    /* layout */
    .container{display:grid;grid-template-columns:260px 1fr 360px;gap:20px;padding:28px;max-width:1200px;margin:0 auto;width:100%;z-index:3}

    /* left column: quick tasks */
    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;padding:18px;box-shadow:0 8px 24px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03)}
    .panel h3{margin:0 0 12px 0;font-size:16px}
    .task-row{display:flex;align-items:center;gap:10px;padding:10px;border-radius:10px;margin-bottom:10px;background:transparent}
    .task-row:hover{background:rgba(255,255,255,0.02);transform:translateY(-2px);transition:all .18s ease}
    .checkbox{width:18px;height:18px;border-radius:4px;border:1px solid rgba(255,255,255,0.06);display:inline-block}
    .title{flex:1}
    .meta{font-size:12px;color:var(--muted)}
    .priority{padding:4px 8px;border-radius:8px;font-size:12px}
    .priority.low{background:rgba(255,255,255,0.02)}
    .priority.medium{background:rgba(255,162,0,0.12);color:#ffdca8}
    .priority.high{background:rgba(255,60,60,0.12);color:#ffc6c6}

    /* center: main content area */
    .main-hero{display:flex;flex-direction:column;gap:20px}
    .controls{display:flex;gap:12px;align-items:center}
    .btn{background:var(--glass);border:1px solid rgba(255,255,255,0.04);padding:8px 12px;border-radius:10px;color:var(--accent);cursor:pointer}
    .btn.primary{background:linear-gradient(90deg,var(--accent),#00a884);color:#012;box-shadow:0 6px 20px rgba(6,214,160,0.12)}

    /* Eisenhower matrix */
    .matrix{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .quad{min-height:160px;border-radius:10px;padding:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02))}
    .quad h4{margin:0 0 8px 0;font-size:14px}

    /* right column: notes and small stats */
    .notes-list{display:flex;flex-direction:column;gap:8px}
    .note{padding:10px;border-radius:8px;background:rgba(255,255,255,0.02)}

    /* modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,8,20,0.6);z-index:40}
    .modal.open{display:flex}
    .modal-card{width:520px;background:linear-gradient(180deg,#07121a,#0b1b20);border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.03)}
    .form-row{display:flex;gap:8px;margin-bottom:10px}
    input,select,textarea{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px;border-radius:8px;color:var(--muted);width:100%}

    /* small chart area */
    .chart{height:150px;border-radius:10px;padding:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));display:flex;align-items:flex-end;gap:6px}
    .bar{flex:1;height:40%;background:linear-gradient(180deg,var(--accent), #00a884);border-radius:6px;display:flex;align-items:flex-end;justify-content:center;color:#001;padding-bottom:6px;font-size:12px}

    /* responsive */
    @media (max-width:1000px){.container{grid-template-columns:1fr;padding:18px} .diagonal-band{display:none}}

    footer{padding:16px;text-align:center;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <div class="page">
    <div class="diagonal-band" aria-hidden="true"></div>
    <header><div class="brand">Premium Task — Demo</div></header>

    <div class="container">
      <!-- LEFT: Quick tasks + add -->
      <section class="panel" aria-labelledby="quick">
        <h3 id="quick">Quick Tasks</h3>
        <div id="taskList"></div>
        <div style="margin-top:12px;display:flex;gap:8px">
          <button class="btn" id="openAdd">+ Add</button>
          <button class="btn" id="clearAll">Clear local</button>
        </div>
      </section>

      <!-- CENTER: matrix + timeline -->
      <main class="main-hero">
        <div class="panel controls">
          <div style="flex:1">
            <label for="filter">Filter:</label>
            <select id="filter"><option value="all">All</option><option value="today">Today</option><option value="week">This week</option><option value="month">This month</option></select>
          </div>
          <div style="display:flex;gap:10px;align-items:center">
            <div style="font-size:13px;color:var(--muted)">Eisenhower</div>
            <button class="btn primary" id="refresh">Refresh</button>
          </div>
        </div>

        <div class="panel">
          <h3 style="margin-top:0">Eisenhower Matrix</h3>
          <div class="matrix" id="matrix">
            <div class="quad" data-q="now"><h4>Now</h4><div class="quad-inner" id="q-now"></div></div>
            <div class="quad" data-q="later"><h4>Later</h4><div class="quad-inner" id="q-later"></div></div>
            <div class="quad" data-q="flexible"><h4>Flexible</h4><div class="quad-inner" id="q-flexible"></div></div>
            <div class="quad" data-q="indefinite"><h4>Indefinite</h4><div class="quad-inner" id="q-indefinite"></div></div>
          </div>
        </div>

        <div class="panel">
          <h3 style="margin-top:0">Timeline (last 7 days)</h3>
          <div class="chart" id="timeline"></div>
        </div>
      </main>

      <!-- RIGHT: notes + mini stats -->
      <aside class="panel">
        <h3 style="margin-top:0">Notes</h3>
        <div class="notes-list" id="notes"></div>
        <textarea id="noteText" rows="3" placeholder="Quick note..." style="margin-top:10px"></textarea>
        <button class="btn" id="saveNote" style="margin-top:8px">Save Note</button>

        <h4 style="margin-top:18px">Stats</h4>
        <div style="display:flex;gap:8px;margin-top:8px">
          <div style="flex:1;background:rgba(255,255,255,0.02);padding:10px;border-radius:8px;text-align:center">Total<br><strong id="statTotal">0</strong></div>
          <div style="flex:1;background:rgba(255,255,255,0.02);padding:10px;border-radius:8px;text-align:center">Done<br><strong id="statDone">0</strong></div>
        </div>
      </aside>
    </div>

    <footer>Frontend-only demo • Data stored in browser localStorage • Integrate with a backend by replacing localStorage calls with fetch()</footer>

    <!-- modal add/edit -->
    <div class="modal" id="modal">
      <div class="modal-card" role="dialog" aria-modal="true">
        <h3 id="modalTitle">Add task</h3>
        <div class="form-row"><input id="t-title" placeholder="Title"></div>
        <div class="form-row"><textarea id="t-desc" rows="3" placeholder="Description (optional)"></textarea></div>
        <div class="form-row"><input id="t-due" type="date"></div>
        <div class="form-row"><select id="t-pri"><option value="low">Low</option><option value="medium">Medium</option><option value="high">High</option></select></div>
        <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:8px">
          <button class="btn" id="close">Cancel</button>
          <button class="btn primary" id="save">Save</button>
        </div>
      </div>
    </div>

  </div>

  <script>
    /* Simple data model in localStorage */
    const STORAGE = 'premium_tasks_v1';
    const NOTES = 'premium_notes_v1';

    function load(){
      const raw = localStorage.getItem(STORAGE) || '[]';
      try{ return JSON.parse(raw) } catch(e){ return [] }
    }
    function save(tasks){ localStorage.setItem(STORAGE, JSON.stringify(tasks)) }
    function loadNotes(){ try{ return JSON.parse(localStorage.getItem(NOTES)||'[]') }catch(e){return[]} }
    function saveNotes(n){ localStorage.setItem(NOTES, JSON.stringify(n)) }

    // helpers
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    // render tasks list
    function renderList(){
      const tasks = load();
      const list = $('#taskList'); list.innerHTML='';
      tasks.slice().reverse().forEach(t=>{
        const el = document.createElement('div'); el.className='task-row';
        el.innerHTML = `<div style=width:8px;height:8px;border-radius:4px;background:${t.done?"#06d6a0":"transparent"};margin-right:8px></div>
          <div class=title>
            <div style='font-weight:600'>${escapeHtml(t.title)}</div>
            <div class=meta>${t.due? t.due : 'No due'}</div>
          </div>
          <div style='display:flex;align-items:center;gap:6px'>
            <div class='priority ${t.priority}'>${t.priority}</div>
            <button class='btn' data-id='${t.id}' data-action='edit'>Edit</button>
            <button class='btn' data-id='${t.id}' data-action='del'>Del</button>
          </div>`;
        list.appendChild(el);
      })
      attachListEvents();
      updateStats();
    }

    function attachListEvents(){
      $$('.task-row button').forEach(b=>b.addEventListener('click', e=>{
        const id = e.currentTarget.dataset.id; const action = e.currentTarget.dataset.action;
        if(action==='edit') openModalFor(id);
        if(action==='del') { if(confirm('Delete?')){ deleteTask(id); } }
      }))
    }

    function escapeHtml(s){ return String(s||'').replace(/[&<>\"]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])) }

    // modal handling
    const modal = $('#modal');
    $('#openAdd').addEventListener('click', ()=>{ openModalFor(); });
    $('#close').addEventListener('click', ()=>{ modal.classList.remove('open') });

    function openModalFor(id){
      const tasks = load();
      if(id){
        const t = tasks.find(x=>x.id==id);
        $('#modalTitle').textContent='Edit task'; $('#t-title').value=t.title; $('#t-desc').value=t.desc||''; $('#t-due').value=t.due||''; $('#t-pri').value=t.priority||'low';
        $('#save').dataset.edit = id;
      } else {
        $('#modalTitle').textContent='Add task'; $('#t-title').value=''; $('#t-desc').value=''; $('#t-due').value=''; $('#t-pri').value='low'; delete $('#save').dataset.edit;
      }
      modal.classList.add('open');
    }

    // save
    $('#save').addEventListener('click', ()=>{
      const title = $('#t-title').value.trim(); if(!title){ alert('Title required'); return }
      const desc = $('#t-desc').value.trim(); const due = $('#t-due').value; const pri = $('#t-pri').value;
      const tasks = load();
      if($('#save').dataset.edit){
        const id = $('#save').dataset.edit; const idx = tasks.findIndex(x=>x.id==id);
        tasks[idx].title = title; tasks[idx].desc = desc; tasks[idx].due = due; tasks[idx].priority = pri;
      } else {
        tasks.push({id:Date.now().toString(36), title, desc, due, priority:pri, created: new Date().toISOString(), done:false});
      }
      save(tasks); modal.classList.remove('open'); renderAll();
    })

    function deleteTask(id){ let tasks = load(); tasks = tasks.filter(t=>t.id!=id); save(tasks); renderAll(); }

    function updateStats(){ const tasks = load(); $('#statTotal').textContent = tasks.length; $('#statDone').textContent = tasks.filter(t=>t.done).length }

    // notes
    $('#saveNote').addEventListener('click', ()=>{
      const n = $('#noteText').value.trim(); if(!n) return; const notes = loadNotes(); notes.unshift({id:Date.now(), text:n, created:new Date().toISOString()}); saveNotes(notes); $('#noteText').value=''; renderNotes();
    })

    function renderNotes(){ const notes = loadNotes(); const out = $('#notes'); out.innerHTML=''; notes.forEach(n=>{ const el = document.createElement('div'); el.className='note'; el.textContent = n.text; out.appendChild(el) }) }

    // quick categorization for matrix
    function categorize(tasks){ const cat = {now:[], later:[], flexible:[], indefinite:[]};
      const today = new Date();
      tasks.forEach(t=>{
        if(!t.due){ cat.indefinite.push(t); return }
        const due = new Date(t.due); const diff = Math.ceil((due - new Date(today.getFullYear(),today.getMonth(),today.getDate()))/86400000);
        let c='indefinite';
        if(diff <= 1) c='now';
        else if(diff <=7) c='later';
        else if(diff <=31) c='flexible';
        else c='indefinite';
        cat[c].push(t);
      })
      return cat;
    }

    function renderMatrix(){ const tasks = load(); const cat = categorize(tasks);
      ['now','later','flexible','indefinite'].forEach(k=>{ const el = document.getElementById('q-'+k); el.innerHTML=''; cat[k].forEach(t=>{ const d = document.createElement('div'); d.style.padding='8px'; d.style.borderRadius='8px'; d.style.marginBottom='6px'; d.style.background='rgba(255,255,255,0.02)'; d.innerHTML = `<strong>${escapeHtml(t.title)}</strong><div style="font-size:12px;color:var(--muted)">${t.due || 'No due'}</div>`; el.appendChild(d) }) }) }

    // timeline: simple daily counts for last 7 days
    function renderTimeline(){ const tasks = load(); const counts = []; const labels = []; const today = new Date(); for(let i=6;i>=0;i--){ const d = new Date(today); d.setDate(today.getDate()-i); const key = d.toISOString().slice(0,10); labels.push(key); counts.push( tasks.filter(t=>t.created.slice(0,10)===key || (t.due && t.due===key)).length ); }
      const chart = $('#timeline'); chart.innerHTML=''; const max = Math.max(...counts,1);
      counts.forEach((c,idx)=>{ const b = document.createElement('div'); b.className='bar'; b.style.height = `${Math.max(8, (c/max)*100)}%`; b.textContent = c; chart.appendChild(b) }) }

    function renderAll(){ renderList(); renderMatrix(); renderTimeline(); renderNotes(); }

    // init
    renderAll();

    // refresh
    $('#refresh').addEventListener('click', ()=>renderAll());

    // clear
    $('#clearAll').addEventListener('click', ()=>{ if(confirm('Clear all demo data?')){ localStorage.removeItem(STORAGE); localStorage.removeItem(NOTES); renderAll(); } })

    // expose small API to console
    window.__app = { load, save, renderAll }
  </script>
</body>
</html>


{% endblock %}